{% extends "eventresult/layout.html" %}

{% block pagecontent %}
<div class="row">
<div class="col-md-10 col-md-offset-1">
<h3>Step 3: Done!</h3>
	<p>Your source is ready!</p>
    <div class="row">
        <div class="col-sm-6">
            <button id="copy-button" type="button" class="btn btn-success center-block" onclick="copyCode()">Copy HTML to my clipboard</button>
        </div>
        <div class="col-sm-6 text-center">
            <a href="{{ url_for('eventResult.static', filename=thefilename) }}" class="btn btn-success" download>Download the .html file</a>
        </div>
    </div>
    <p><pre id="copy-content" class="pre-scrollable" style="max-height:150px">{{ thehtml|escape }}</pre></p>
</div>
</div>
<div class="row">
<div class="col-md-10 col-md-offset-1">
    <p>Here's a preview of your results. Keep in mind styles will not match your final site if your template includes classes from your site's own style sheet. If you don't see anything in the box, <a href="{{ url_for('eventResult.static', filename=thefilename) }}" target="_blank">click here</a> to view the page in a new tab.</p>
<div id="iframewrap" style="width:100%; height:506px; border-style:solid; border-size:2px; margin-bottom:20px;">
<iframe srcdoc="{{ thehtml }}" height="500px" style="width:100%; border-style:none;"></iframe>
</div>
</div>
</div>
{% endblock %}

{% block bottomscripts %}
<script>
    // copyCode adapted from https://codepen.io/ryanbuckley13/pen/gpyrwe
function copyCode() {
    var content = $('#copy-content');
    //creates new range object and sets text as boundaries.
    var range = document.createRange();
    range.selectNode(content[0]);
    window.getSelection().addRange(range);
    try {
      // Now that we've selected the text, execute the copy command  
      var successful = document.execCommand('copy');
      /*var msg = successful ? 'successful' : 'unsuccessful';
      console.log('Copy command was ' + msg);*/
    } catch (err) {
      // console.log('Oops, unable to copy');
    }
    try {
        //clear out range for next event.
        window.getSelection().removeAllRanges();
    } catch (err) {
    }
}
</script>
{% endblock %}
